# 2025-08-19 Dev Notes

## Context
- Yesterday: Began assessing legacy loaders/metrics and components (filters, KPIGrid, QueryBox, etc.).  
- Today: Continue assessment of legacy loader files (archival, scopeRouter, schemaGuards, etc.) and document findings. Also refined dev-notes structure with master log + template.  
- Today’s progress: Created and integrated `controlsContext.jsx` as the official state store for Analytics; refactored `Analytics.jsx` into `AnalyticsInner` and a wrapper with provider; fixed default export bug and corrected JSX extension for proper parsing.

---

## Review
- **Legacy loaders:**  
  - `archivalDataLoader.js`: designed to safeguard and pull reduced-grain orders pre-2024-04-09; not used in new pipeline but important context.  
  - `scopeRouter.js`: fallback routing for old fullDataLoader → ensures compatibility; likely can be retired once new pipeline fully adopted.  
  - `schemaGuards.js`: still relevant as a normalization layer to protect downstream metrics from missing fields.  
- Overall: most legacy loaders/metrics are redundant, but `schemaGuards` has practical utility worth keeping in some form.  
- `controlsContext.jsx` created and functioning (was `.js`, changed to `.jsx` due to JSX parse error).  
- `Analytics.jsx` split into `AnalyticsInner` and wrapper `Analytics` with provider.  
- Table fetching logic now tied to controls state (`kpiId`, `state.period`, `state.range`).

---

## Components Assessment
- `filters/` directory → agreed to delete and rebuild fresh via TabDropPanel.  
- `KPIGrid.jsx`, `QueryBox.jsx` → appear unused, can likely be removed.  
- `SortContextMenu.jsx` → uncertain, needs validation if mock/test-only.  
- `TabDropPanel.jsx` → keep as base shell for new filter/controls. Panels confirmed to start closed, and provider wiring stable.  
- `tableLayout.js` → confirmed in use by `GeneratedTable`, must stay.  

---

## Agenda Going Forward
- Remove `filters/` folder and unused legacy component shells.  
- Keep `schemaGuards.js` (normalizeOrderRow + matchesDate utils).  
- Confirm if `SortContextMenu.jsx` is wired anywhere.  
- Begin designing per-tab drop panel layouts (TabDropPanel child logic).  
- Start wiring TabDropPanel → pipeline data fetch.  
- Define panel content wiring (per tab) using controls context.  
- Expand controlsContext to include additional toggles/filters (channel, scope, etc.).

---

## Decisions Made
- [x] Daily README system established (`README_MASTER.md`, `TEMPLATE.md`, `YYYY-MM-DD_NOTES.md`).  
- [x] Filters folder marked for removal.  
- [x] KPIGrid and QueryBox flagged as unused → removal candidate.  
- [ ] Confirm status of SortContextMenu before deletion.  
- [ ] Decide how/where to integrate schemaGuards in new pipeline.  
- [x] controlsContext.jsx adopted as official state store for Analytics.  
- [x] Analytics.jsx refactored and verified stable.  
- [x] Panels default closed on render.

---

## Links / References
- [README_MASTER.md](./README_MASTER.md) – master dev notes index  
- [2025-08-19_NOTES.md](./2025-08-19_NOTES.md) – yesterday’s notes  